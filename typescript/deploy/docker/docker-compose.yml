# agentbe-daemon Docker Compose
#
# Usage (from this directory):
#   cp ../../../.env.example ../../../.env  # First time only
#   docker-compose up -d
#   docker-compose logs -f
#   docker-compose down
#
# Or use `make dev-remote` from monorepo root (recommended for development)
#
# CLI defaults if not set in .env: MCP_PORT=3001, SSH_USERS=root:agents

services:
  agentbe-daemon:
    build:
      context: ../..
      dockerfile: deploy/docker/Dockerfile.runtime
    image: agentbe-daemon:latest
    container_name: agentbe-daemon
    ports:
      - "2222:22" # SSH
      - "3001:3001" # MCP
    volumes:
      - ./var/workspace:/var/workspace
      # Uncomment for SSH key auth:
      # - ./keys:/keys:ro
    env_file:
      - ../../../.env
    restart: unless-stopped
    healthcheck:
      test: [ "CMD", "curl", "-f", "http://localhost:3001/health" ]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 10s
